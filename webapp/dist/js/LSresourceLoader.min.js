var scriptQueue=[],LSresourceLoader=function(e){var t=function(e){var t=this;t.url=e.url,t.no=e.no,t.ver=e.ver,t.onload=e.onload,t.quantity=e.quantity;var o={no:t.no,ver:t.ver,key:null,text:null,onload:t.onload,done:!1};scriptQueue[t.no]=o;var r=t.getScriptFromLS(t.url);if(null!==r&&"refresh"!==t.ver)o.key=t.url,o.text=r,t.injectScriptsInOrder(t);else if(null===r||"refresh"===t.ver){var n=null;try{n=new XMLHttpRequest}catch(e){n=new ActiveXObject("Microsoft.XMLHTTP")}n.open("GET",e.url,!0),n.send(null),n.onreadystatechange=function(){4==n.readyState&&(200==n.status?(console.log("获取脚本："+t.url),t.setScriptToLS(t.url,n.responseText,t.no,t.ver),o.key=t.url,o.text=n.responseText,t.injectScriptsInOrder(t)):console.log("出错了,Err："+n.status))}}};return t.prototype.getScriptFromLS=function(e){return window.localStorage?localStorage.getItem(e):null},t.prototype.setScriptToLS=function(e,t,o,r){window.localStorage&&(localStorage.setItem(e,t),localStorage.setItem("cache-js-"+o,r),console.log(e+" 被存入LS"))},t.prototype.injectScriptsInOrder=function(e){for(var t=scriptQueue.length,o=0;o<t;o++){var r=scriptQueue[o];if(!r.done){if(null===r.text){console.log(e.url+" 还没加载完成");break}e.injectScriptTagToDOM(r),o==quantity-1&&console.log("资源准备就绪")}}},t.prototype.injectScriptTagToDOM=function(e){var t=document.createElement("script");t.type="text/javascript",t.text=e.text,document.getElementsByTagName("body")[0].appendChild(t),e.onload&&e.onload(),e.done=!0,console.log(e.key+" 插入了DOM")},new t(e)};